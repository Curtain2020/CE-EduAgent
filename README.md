# å…·æœ‰é•¿æœŸè®°å¿†å’ŒçŸ¥è¯†å›¾è°±çš„è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ

ä¸€ä¸ªåŸºäº [Zep Cloud](https://getzep.com/) è®°å¿†ç®¡ç†ã€[Qwen API](https://dashscope.aliyuncs.com/) å¯¹è¯ç”Ÿæˆã€[LangGraph](https://langchain-ai.github.io/langgraph/) çŠ¶æ€ç®¡ç†å’Œ [Neo4j](https://neo4j.com/) çŸ¥è¯†å›¾è°±çš„æ™ºèƒ½è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ç³»ç»Ÿæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LangGraph     â”‚    â”‚   Zep Cloud     â”‚    â”‚   Qwen API      â”‚
â”‚   å·¥ä½œæµç®¡ç†    â”‚    â”‚   é•¿æœŸè®°å¿†      â”‚    â”‚   è¯­è¨€æ¨¡å‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Neo4j         â”‚
                    â”‚   çŸ¥è¯†å›¾è°±      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. é•¿æœŸè®°å¿† (Zep Cloud)
- **è‡ªåŠ¨æ£€ç´¢**: æ£€ç´¢å†å²å¯¹è¯å†…å®¹å’Œç›¸å…³äº‹å®
- **å›¾æœç´¢**: æ”¯æŒäº‹å®å’ŒèŠ‚ç‚¹çš„å›¾æœç´¢åŠŸèƒ½
- **ä¸Šä¸‹æ–‡ç®¡ç†**: æ™ºèƒ½ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡

#### 2. çŸ¥è¯†å›¾è°± (Neo4j)
- **ä¸°å¯Œæ•°æ®**: åŒ…å« 1441 ä¸ªå°å­¦æ•°å­¦çŸ¥è¯†ç‚¹
- **ç›¸ä¼¼åº¦æœç´¢**: åŸºäº jellyfish çš„ Jaro-Winkler è·ç¦»ç®—æ³•
- **çŠ¶æ€ç®¡ç†**: æ”¯æŒå·²æŒæ¡/æœªå­¦ä¹ /çŸ¥è¯†æ··æ·†çŠ¶æ€
- **åŠ¨æ€æ›´æ–°**: å®æ—¶æ›´æ–°å­¦ä¹ å†…å®¹å’ŒæŒæ¡çŠ¶æ€

#### 3. æ™ºèƒ½å­¦ä¹ è¡Œä¸º
- **ç¬¬ä¸€é˜¶æ®µ**: æ¥æ”¶æé—®ä¸å›å¿†çŸ¥è¯†
  - è‡ªåŠ¨è°ƒç”¨ `recall_knowledge_tool` æ£€ç´¢ç›¸å…³çŸ¥è¯†
  - æ ¹æ®æŒæ¡çŠ¶æ€ç»™å‡ºä¸åŒå›ç­”ï¼š
    - å·²æŒæ¡ï¼šè‡ªä¿¡ã€æµåˆ©åœ°å›ç­”
    - æœªå­¦ä¹ ï¼šè¯šå®æ‰¿è®¤ä¸ä¼š
    - çŸ¥è¯†æ··æ·†ï¼šç»™å‡ºé”™è¯¯ç­”æ¡ˆä¾›è€å¸ˆçº æ­£

- **ç¬¬äºŒé˜¶æ®µ**: å­¦ä¹ ä¸è®°å½•æ–°çŸ¥
  - ä¸è€å¸ˆè¿›è¡Œå­¦ä¹ å¯¹è¯
  - è°ƒç”¨ `update_knowledge_tool` æ›´æ–°çŸ¥è¯†çŠ¶æ€
  - è®°å½•å­¦ä¹ å†…å®¹åˆ°çŸ¥è¯†å›¾è°±

### åŸºç¡€èŠå¤©æœºå™¨äºº (`chatbot.py`)
- **æ™ºèƒ½è®°å¿†ç®¡ç†**: åŸºäº Zep Cloud çš„ç”¨æˆ·è®°å¿†å’Œä¸Šä¸‹æ–‡ç®¡ç†
- **Qwen API é›†æˆ**: ä½¿ç”¨é˜¿é‡Œäº‘é€šä¹‰åƒé—®è¿›è¡Œå¯¹è¯ç”Ÿæˆ
- **å¤šçº¿ç¨‹æ”¯æŒ**: æ”¯æŒå¤šç”¨æˆ·å¹¶å‘å¯¹è¯
- **äº¤äº’å¼ç•Œé¢**: ç¾è§‚çš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ”¯æŒå®æ—¶å¯¹è¯

### è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ (`virtual_student.py`)
- **é•¿æœŸè®°å¿†æ£€ç´¢**: ä½¿ç”¨ Zep çš„å›¾æœç´¢åŠŸèƒ½æ£€ç´¢ç›¸å…³äº‹å®å’ŒèŠ‚ç‚¹
- **çŸ¥è¯†åº“ç®¡ç†**: æ”¯æŒæ£€ç´¢å’Œæ›´æ–°è™šæ‹Ÿå­¦ç”Ÿçš„çŸ¥è¯†åº“
- **LangGraph å·¥ä½œæµ**: ä½¿ç”¨ LangGraph ç®¡ç†å¯¹è¯çŠ¶æ€å’Œå·¥å…·è°ƒç”¨
- **æ™ºèƒ½å·¥å…·**: é›†æˆæ ¸å¿ƒå·¥å…·ï¼š
  1. `recall_knowledge_tool`: æŸ¥è¯¢çŸ¥è¯†ï¼Œè¿”å›top3ç›¸ä¼¼ç»“æœ
  2. `update_knowledge_tool`: å­¦ä¹ å¹¶è®°å½•è€å¸ˆæ•™çš„æ–°å†…å®¹

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- Python 3.8+
- Zep Cloud è´¦æˆ·å’Œ API å¯†é’¥
- é˜¿é‡Œäº‘é€šä¹‰åƒé—® API å¯†é’¥
- Neo4j æ•°æ®åº“ (æœ¬åœ°æˆ–äº‘ç«¯)

## ğŸ› ï¸ å®‰è£…é…ç½®

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <your-repo-url>
cd ZEP
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒé…ç½®æ¨¡æ¿ï¼š

```bash
cp env_template.txt .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„ API å¯†é’¥ï¼š

```bash
# Zep Cloud API å¯†é’¥
ZEP_API_KEY=your_zep_api_key_here

# Qwen API é…ç½®
QWEN_API_KEY=your_qwen_api_key_here
QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
QWEN_MODEL=qwen-max

# Neo4j é…ç½®
NEO4J_URI=bolt://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your_neo4j_password

# å¯é€‰é…ç½®
BOT_NAME=æ™ºèƒ½åŠ©æ‰‹
TEMPERATURE=0.7
MAX_TOKENS=2000
TIMEOUT=30
```

### 4. å¯åŠ¨Neo4jæ•°æ®åº“

ç¡®ä¿Neo4jæ•°æ®åº“è¿è¡Œåœ¨ `bolt://localhost:7687`ï¼Œç”¨æˆ·å `neo4j`ï¼Œå¯†ç  `51265903089`

### 5. å¯¼å…¥çŸ¥è¯†å›¾è°±æ•°æ®

```bash
python3 å¯¼å…¥json.py
```

### 6. è·å– API å¯†é’¥

#### Zep Cloud API å¯†é’¥
1. è®¿é—® [Zep Cloud](https://getzep.com/)
2. æ³¨å†Œè´¦æˆ·å¹¶åˆ›å»ºé¡¹ç›®
3. åœ¨é¡¹ç›®è®¾ç½®ä¸­è·å– API å¯†é’¥

#### Qwen API å¯†é’¥
1. è®¿é—® [é˜¿é‡Œäº‘é€šä¹‰åƒé—®](https://dashscope.aliyuncs.com/)
2. æ³¨å†Œè´¦æˆ·å¹¶å¼€é€šæœåŠ¡
3. è·å– API å¯†é’¥

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œå®Œæ•´è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ
```bash
python3 virtual_student.py
```

### 2. è¿è¡Œé›†æˆæµ‹è¯•
```bash
python3 test_knowledge_integration.py
```

### 3. è¿è¡Œç®€åŒ–æ¼”ç¤º
```bash
python3 simple_demo.py
```

### 4. åŸºç¡€èŠå¤©æœºå™¨äºº
```bash
python3 chatbot.py
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
ZEP/
â”œâ”€â”€ virtual_student.py              # ä¸»è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ
â”œâ”€â”€ knowledge_graph_manager.py      # Neo4jçŸ¥è¯†å›¾è°±ç®¡ç†å™¨
â”œâ”€â”€ chatbot.py                      # åŸºç¡€èŠå¤©æœºå™¨äºº
â”œâ”€â”€ å¯¼å…¥json.py                     # æ•°æ®å¯¼å…¥è„šæœ¬
â”œâ”€â”€ test_knowledge_integration.py  # é›†æˆæµ‹è¯•
â”œâ”€â”€ simple_demo.py                  # ç®€åŒ–æ¼”ç¤º
â”œâ”€â”€ requirements.txt                # ä¾èµ–åŒ…
â”œâ”€â”€ .env                           # ç¯å¢ƒå˜é‡é…ç½®
â””â”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### çŸ¥è¯†å›¾è°±ç®¡ç†å™¨ (`knowledge_graph_manager.py`)
- **KnowledgeGraphManager ç±»**: Neo4jæ•°æ®åº“è¿æ¥å’Œç®¡ç†
- **ç›¸ä¼¼åº¦æœç´¢**: åŸºäºjellyfishçš„Jaro-Winklerè·ç¦»ç®—æ³•
- **çŠ¶æ€æ›´æ–°**: æ”¯æŒçŸ¥è¯†ç‚¹æŒæ¡çŠ¶æ€çš„åŠ¨æ€æ›´æ–°
- **ç»Ÿè®¡ä¿¡æ¯**: æä¾›çŸ¥è¯†å›¾è°±çš„ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

### è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ (`virtual_student.py`)
- **StudentState**: LangGraph çŠ¶æ€å®šä¹‰
- **VirtualStudent ç±»**: è™šæ‹Ÿå­¦ç”Ÿæ ¸å¿ƒé€»è¾‘
- **QwenAPIClient ç±»**: æ”¯æŒå·¥å…·è°ƒç”¨çš„Qwen APIå®¢æˆ·ç«¯
- **çŸ¥è¯†åº“å·¥å…·**: çŸ¥è¯†æ£€ç´¢å’Œæ›´æ–°å·¥å…·
- **LangGraph å·¥ä½œæµ**: çŠ¶æ€ç®¡ç†å’Œå·¥å…·è°ƒç”¨æµç¨‹

### æ ¸å¿ƒå·¥å…·
- **recall_knowledge_tool**: æŸ¥è¯¢çŸ¥è¯†ï¼Œè¿”å›top3ç›¸ä¼¼ç»“æœ
- **update_knowledge_tool**: å­¦ä¹ å¹¶è®°å½•è€å¸ˆæ•™çš„æ–°å†…å®¹

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€èŠå¤©æœºå™¨äºº

```python
from chatbot import ZepChatbot

# åˆ›å»ºèŠå¤©æœºå™¨äººå®ä¾‹
chatbot = ZepChatbot()

# åˆ›å»ºç”¨æˆ·
user_id = chatbot.create_user(
    user_name="å¼ ä¸‰",
    email="zhangsan@example.com",
    first_name="å¼ ä¸‰"
)

# åˆ›å»ºå¯¹è¯çº¿ç¨‹
thread_id = chatbot.create_thread(user_id)

# ç”Ÿæˆå›å¤
response = chatbot.generate_response(thread_id, "ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£äº§å“ä¿¡æ¯")
print(response)
```

### è™šæ‹Ÿå­¦ç”Ÿç³»ç»Ÿ

```python
from virtual_student import VirtualStudent, create_student_workflow

# åˆ›å»ºè™šæ‹Ÿå­¦ç”Ÿ
student = VirtualStudent()
student_id = await student.create_student_user("å°æ˜", "xiaoming@student.com")
thread_id = await student.create_study_thread(student_id)

# åˆ›å»ºå·¥ä½œæµ
app = create_student_workflow(student_name, zep_client, qwen_client)

# è¿è¡Œå¯¹è¯
result = await app.ainvoke(state)
```

## ğŸ“ æ¼”ç¤ºæ•ˆæœ

### çŸ¥è¯†å›¾è°±ç»Ÿè®¡
- **æ€»èŠ‚ç‚¹æ•°**: 1441ä¸ªçŸ¥è¯†ç‚¹
- **å¹´çº§åˆ†å¸ƒ**: å°å­¦ä¸€å¹´çº§åˆ°å…­å¹´çº§
- **å­¦ç§‘**: æ•°å­¦
- **çŠ¶æ€ç®¡ç†**: æ”¯æŒå·²æŒæ¡/æœªå­¦ä¹ /çŸ¥è¯†æ··æ·†çŠ¶æ€

### ç³»ç»ŸåŠŸèƒ½æ¼”ç¤º
è¿è¡Œæ¼”ç¤ºç¨‹åºå¯ä»¥çœ‹åˆ°å®Œæ•´çš„è™šæ‹Ÿå­¦ç”ŸåŠŸèƒ½ï¼š

```bash
python3 simple_demo.py
```

æ¼”ç¤ºåŒ…æ‹¬ï¼š
1. **çŸ¥è¯†æœç´¢**: åŸºäºç›¸ä¼¼åº¦çš„æ™ºèƒ½æœç´¢
2. **çŸ¥è¯†æ£€ç´¢**: è¿”å›top3ç›¸ä¼¼ç»“æœä¾›é€‰æ‹©
3. **å­¦ä¹ è®°å½•**: åŠ¨æ€æ›´æ–°çŸ¥è¯†ç‚¹æŒæ¡çŠ¶æ€
4. **æ™ºèƒ½å›ç­”**: æ ¹æ®æŒæ¡çŠ¶æ€ç»™å‡ºä¸åŒå›ç­”

### å®é™…è¿è¡Œæ•ˆæœ
ç³»ç»Ÿèƒ½å¤Ÿï¼š
- æ ¹æ®é—®é¢˜è‡ªåŠ¨æ£€ç´¢ç›¸å…³çŸ¥è¯†
- æ ¹æ®æŒæ¡çŠ¶æ€ç»™å‡ºä¸åŒå›ç­”
- å­¦ä¹ æ–°çŸ¥è¯†å¹¶æ›´æ–°çŸ¥è¯†å›¾è°±
- ç»´æŠ¤é•¿æœŸè®°å¿†å’Œå­¦ä¹ å†å²

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **API å¯†é’¥é”™è¯¯**
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ API å¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ API å¯†é’¥æœ‰è¶³å¤Ÿçš„æƒé™

2. **Neo4j è¿æ¥é—®é¢˜**
   - ç¡®ä¿ Neo4j æ•°æ®åº“æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥è¿æ¥å‚æ•°ï¼ˆURIã€ç”¨æˆ·åã€å¯†ç ï¼‰
   - ç¡®è®¤é˜²ç«å¢™è®¾ç½®å…è®¸ 7687 ç«¯å£

3. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤é˜²ç«å¢™è®¾ç½®

4. **ä¾èµ–å®‰è£…é—®é¢˜**
   - ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼š`python -m venv venv && source venv/bin/activate`
   - å‡çº§ pipï¼š`pip install --upgrade pip`
   - å®‰è£… Neo4j é©±åŠ¨ï¼š`pip install neo4j jellyfish`

5. **LangGraph ç›¸å…³é—®é¢˜**
   - ç¡®ä¿å®‰è£…äº†æ‰€æœ‰ LangGraph ä¾èµ–
   - æ£€æŸ¥ Python ç‰ˆæœ¬å…¼å®¹æ€§

### è°ƒè¯•æ¨¡å¼

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
export LOG_LEVEL=DEBUG
python chatbot.py
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Zep Cloud æ–‡æ¡£](https://help.getzep.com/)
- [Zep LangGraph é›†æˆ](https://help.getzep.com/ecosystem/langgraph-memory)
- [Qwen API æ–‡æ¡£](https://help.aliyun.com/zh/dashscope/)
- [LangGraph æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [Neo4j Python é©±åŠ¨](https://neo4j.com/docs/python-manual/current/)
- [Jellyfish ç›¸ä¼¼åº¦ç®—æ³•](https://github.com/jamesturk/jellyfish)
- [Python ç¯å¢ƒç®¡ç†](https://docs.python.org/3/tutorial/venv.html)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License