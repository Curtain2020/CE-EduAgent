# 可视化界面部署流程

## 注意：模型调用方法参考qwen_request.py进行修改

## 一、环境安装与配置

### 1. 创建并激活虚拟环境
```bash
# 创建虚拟环境
conda create -n zep-env python=3.8

# 激活环境
source activate zep-env
```

### 2. 安装项目依赖
```bash
# 进入项目目录
cd ~/CE-EduAgent

# 安装依赖
pip install -r requirements.txt

# 如需手动安装关键依赖
pip install flask neo4j-driver visdcc gunicorn
```

### 3. Neo4j 安装与配置

#### 3.1 安装 Neo4j
```bash
# 使用 Homebrew 安装（MacOS）
brew install neo4j

# 或使用 apt 安装（Ubuntu）
sudo apt update
sudo apt install neo4j
```

#### 3.2 启动 Neo4j 服务
```bash
# 启动 Neo4j 服务
neo4j start

# 检查服务状态
neo4j status
```

#### 3.3 配置 Neo4j 连接
- 打开浏览器访问：http://localhost:7474
- 默认用户名：neo4j
- 默认密码：neo4j
- 首次登录需修改密码，建议改为代码中的密码：51265903089
- 在项目配置文件中设置正确的 Neo4j 连接信息

## 二、项目部署

### 1. 进入项目目录
```bash
cd ~/CE-EduAgent
```

### 2. 激活环境
```bash
source activate zep-env
```

### 3. 彻底清理旧进程（防止端口占用）
```bash
pkill -9 gunicorn
# 清理可能占用8081端口的进程
lsof -i :8081 | grep LISTEN | awk '{print $2}' | xargs kill -9 2>/dev/null
```

### 4. 启动服务（监听本地8081）
```bash
# 调试阶段建议不加nohup，直接看输出日志
gunicorn -w 4 -b 127.0.0.1:8081 visualization:app

# 生产环境使用nohup后台运行
nohup gunicorn -w 4 -b 127.0.0.1:8081 visualization:app > gunicorn.log 2>&1 &
```

## 三、本地访问（如果在135上直接用的话不需要这一步）

### 1. 配置 SSH 端口转发（注意链接校园网）
```bash
ssh -L 8081:127.0.0.1:8081 服务器名@服务器ip
```

### 2. 浏览器访问
打开 Chrome 或 Safari，在地址栏输入：
```
http://127.0.0.1:8081
```

## 四、常见问题排查

### 1. Neo4j 连接失败
- 检查 Neo4j 服务是否运行
- 验证连接用户名和密码是否正确
- 确认项目配置中的 Neo4j 连接 URL 是否正确

### 2. 端口占用问题
- 使用 `lsof -i :8081` 查看端口占用情况
- 使用 `kill -9 <PID>` 终止占用端口的进程

### 3. 依赖安装失败
- 确保网络连接正常
- 尝试使用 `pip install --upgrade pip` 更新 pip
- 检查 Python 版本是否符合要求

### 4. 服务启动失败
- 查看 Gunicorn 日志：`cat gunicorn.log`
- 检查 Flask 应用是否有语法错误
- 确认所有环境变量和配置文件是否正确设置